<div id=D__ID>
    <section id=form_container__ID>
        <div id=header__ID>
            Employee Appointment Form
        </div>
        <form id=F__ID>
            <div class="container">
                <!-- Form Inputs-------------------------------------->
                <div class="row row__ID">
                    <div class=col-md-3>
                        Contract Type:
                    </div>
                    <div class=col-md-9>
                        <label><input type="radio" name=Contract_x0020_Type value='New Hire' /> New Hire</label><br>
                        <label><input type="radio" name=Contract_x0020_Type value='Contract Renewal' /> Contract Renewal</label><br>
                        <label><input type="radio" name=Contract_x0020_Type value='Variation to Existing Contract' /> Variation to Existing Contract</label><br>
                    </div>
                </div>


                <hr class=hr__ID>
                <div class=row>
                    <div class='col bk__ID'>
                        <b>Appointee Details:</b>
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Employee Code (If he/she is a current employee):
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Employee_x0020_Code /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Title/Salutation:
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Salutation /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        First Name:
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=First_x0020_Name /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Surname:
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Surname /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Gender:
                    </div>
                    <div class=col-md-9>
                        <select class=form-control name=Gender >
                                <option value=''></option>
                                <option>Male</option>
                                <option>Female</option>
                                <option>Other</option>
                        </select> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Address:
                    </div>
                    <div class=col-md-9>
                        <textarea class=form-control name=Address ></textarea>
                    </div>
                </div>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Date Of Birth:
                    </div>
                    <div class=col-md-9>
                        <input type="date" class=form-control name=Date_x0020_of_x0020_Birth /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Email address:
                    </div>
                    <div class=col-md-9>
                        <input type="email" class=form-control name=Email_x0020_Address /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Phone Number (Home):
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Phone_x0020_Home /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Phone Number (Mobile):
                    </div>
                    <div class=col-md-9>
                        <input type="number" class=form-control name=Mobile /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class=row>
                    <div class='col bk__ID'>
                        <b>Position Details:</b>
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Primary Department Name:
                    </div>
                    <div class=col-md-4>
                        <label><input type="checkbox" name="Sleep_Technicians" /> Sleep Technicians</label><br>
                        <label><input type="checkbox" name=Neurobiology /> Neurobiology</label><br>
                        <label><input type="checkbox" name="Sleep_and_Circadian" /> Sleep and Circadian</label><br>
                        <label><input type="checkbox" name=Sleep_Group /> Sleep Group</label><br>
                        <label><input type="checkbox" name=Cardio-metabolic /> Cardio-metabolic</label><br>
                        <label><input type="checkbox" name="Epidemiology__Clinical_Trials" /> Epidemiology/Clinical Trials</label><br>
                        <label><input type="checkbox" name=Operations /> Operations</label><br>
                    </div>
                    <div class=col-md-4>
                        <label><input type="checkbox" name=Commercial /> Commercial</label><br>
                        <label><input type="checkbox" name=Woolcock_Therapy_Centre /> Woolcock Therapy Centre</label><br>
                        <label><input type="checkbox" name=Woolcock_Reception /> Woolcock Reception</label><br>
                        <label><input type="checkbox" name=Clinical_Management /> Clinical Management</label><br>
                        <label><input type="checkbox" name=Respiratory_Technology /> Respiratory Technology</label><br>
                        <label><input type="checkbox" name=Airway_Physiology_and_Imaging /> Airway Physiology and Imaging</label><br>
                        <label><input type="checkbox" name=Emphysema_Group /> Emphysema Group</label><br>
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Funding Grantor/Institute
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Funding_x0020_Grantor_x002f_Inst /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Project Code/Default Cost Account
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Project_x0020_Code /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Employee Position Title
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Employee_x0020_Position_x0020_Ti /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Reporting To
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Reporting_x0020_To /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Manager Name who will be approving Timesheets and/or Annual Leave
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Manager_x0020_Name_x0020_ /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Contract/Variation Start Date
                    </div>
                    <div class=col-md-9>
                        <input type="date" class=form-control name=Contract_x0020_Start_x0020_Date /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Contract/Variation End Date
                    </div>
                    <div class=col-md-9>
                        <input type="date" class=form-control name=Contract_x0020_End_x0020_Date /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Employment Status
                    </div>
                    <div class=col-md-9>
                        <label><input type="radio" name=Employment_x0020_Status value='Casual' /> Casual</label><br>
                        <label><input type="radio" name=Employment_x0020_Status value='Fixed Term – Full-Time' /> Fixed Term – Full-Time</label><br>
                        <label><input type="radio" name=Employment_x0020_Status value='Fixed Term – Part-Time' /> Fixed Term – Part-Time</label><br>
                        <label><input type="radio" name=Employment_x0020_Status value='Ongoing – Full-Time' /> Ongoing – Full-Time</label><br>
                        <label><input type="radio" name=Employment_x0020_Status value='Ongoing – Part-Time' /> Ongoing – Part-Time</label><br>
                        <label><input type="radio" name=Employment_x0020_Status value='Other' /> Other  (Specify):</label><br>
                        <input type="text" class=form-control _name=Other_Specify />
                    </div>
                </div>
                <hr class=hr__ID>
                <hr class=hr__ID>
                <div class="row">
                    <div class=col-md-3>
                        Usual Days and list the Usual Hours of work per day
                    </div>
                    <div class=col-md-9>
                        <div class="row">
                            <div class=col-md-3>
                                Day of the week
                            </div>
                            <div class=col-md-3>
                                Start time
                            </div>
                            <div class=col-md-3>
                                Finish time
                            </div>
                            <div class=col-md-3>
                                Unpaid break
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-3>
                                <label><input type="checkbox" name=Monday /> Monday</label>
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=MondayStartTime />
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=MondayFinishTime />
                            </div>
                            <div class=col-md-3>
                                <input type="text" class=form-control _name=Monday_Unpaid_break />
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-3>
                                <label><input type="checkbox" name=Tuesday /> Tuesday</label>
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=TuesdayStartTime />
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=TuesdayFinishTime />
                            </div>
                            <div class=col-md-3>
                                <input type="text" class=form-control _name=Tuesday_Unpaid_break />
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-3>
                                <label><input type="checkbox" name=Wednesday /> Wednesday</label>
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=WednesdayStartTime />
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=WednesdayFinishTime />
                            </div>
                            <div class=col-md-3>
                                <input type="text" class=form-control _name=Wednesday_Unpaid_break />
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-3>
                                <label><input type="checkbox" name=Thursday /> Thursday</label>
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=ThursdayStartTime />
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=ThursdayFinishTime />
                            </div>
                            <div class=col-md-3>
                                <input type="text" class=form-control _name=Thursday_Unpaid_break />
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-3>
                                <label><input type="checkbox" name=Friday /> Friday</label>
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=FridayStartTime />
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=FridayFinishTime />
                            </div>
                            <div class=col-md-3>
                                <input type="text" class=form-control _name=Friday_Unpaid_break />
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-3>
                                <label><input type="checkbox" name=Saturday /> Saturday</label>
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=SaturdayStartTime />
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=SaturdayFinishTime />
                            </div>
                            <div class=col-md-3>
                                <input type="text" class=form-control _name=Saturday_Unpaid_break />
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-3>
                                <label><input type="checkbox" name=Sunday /> Sunday</label>
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=SundayStartTime />
                            </div>
                            <div class=col-md-3>
                                <input type="time" class=form-control name=SundayFinishTime />
                            </div>
                            <div class=col-md-3>
                                <input type="text" class=form-control _name=Sunday_Unpaid_break />
                            </div>
                        </div>
                    </div>
                </div>



                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Select the appropriate Award or select Award Free: 
                    </div>
                    <div class=col-md-9>
                        <label><input type="checkbox" name=Award_Free /> Award Free</label><br>
                        <label><input type="checkbox" name=Health_Professionals_and_Support_Services_Award_2010 /> Health Professionals and Support Services Award 2010</label><br>
                        <label><input type="checkbox" name=Professional_Employees_Award_2010 /> Professional Employees Award 2010</label><br>
                        <label><input type="checkbox" name=Clerks_Private_Sector_Award_2010 /> Clerks Private Sector Award 2010</label><br>
                        <label><input type="checkbox" name=Hospitality_Industry_General_Award_2010 /> Hospitality Industry General Award 2010</label><br>
                        <label><input type="checkbox" name=Manufacturing_and_Associated_Industries_and_Occupations_Award_2010 /> Manufacturing and Associated Industries and Occupations Award 2010</label><br>
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Award Classification:
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Award_x0020_Classification /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Wage (per hour) or Salary (per annum) (Note: if the salary is other than FTE 100% or if casual note does the rate included casual loading or not)
                    </div>
                    <div class=col-md-9>
                        <input type="number" class=form-control name=Salary step=0.01 /> 
                    </div>
                </div>
                
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Is a Working with Children Check required for this position?
                    </div>
                    <div class=col-md-9>
                        <label><input type="radio" name=Child_x0020_Check value=Yes_Have /> Yes and has a current WWCC - please list their WWCC number below</label><br>
                        <label><input type="radio" name=Child_x0020_Check value=Yes_Not_Have /> Yes but does not have a current WWCC.</label><br>
                        <label><input type="radio" name=Child_x0020_Check value=No /> No</label><br>
                        The Working with Children Check Number is:<br>
                        <input type="text" class=form-control name=Children_x0020_Check_x0020_Numbe />
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Is a Police Check required for this position?
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Police_x0020_Check />
                        <br>
                        <!--
                        <label><input type="radio" name=Police_Check value=Yes /> Yes</label><br>
                        <label><input type="radio" name=Police_Check value=No /> No</label><br>
                        -->
                        Police Check reference number:<br>
                        <input type="text" class=form-control name=Police_x0020_Ref_x0020_Number />
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Is the employee required to wear a uniform? 
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Uniform_x0020_Required />
                        <!--
                        <label><input type="radio" name=required_to_wear_a_uniform value=Yes_Issued /> Yes, the employee has been issued with their uniform, the laundry allowance to  be paid effective from</label><br>
                        <input type="date" class=form-control name=Yes_Issued_Paid_Date_From />
                        <label><input type="radio" name=required_to_wear_a_uniform value=Yes_Not_Issued /> Yes, however the employee has not been issued with their uniform yet. The Manager to advise payroll and HR once the uniform has been issued and the date the laundry allowance is to apply from</label><br>
                        <input type="date" class=form-control name=Yes_Not_Issued_Date_From />
                        <label><input type="radio" name=required_to_wear_a_uniform value=No /> No, a uniform is not required.</label><br>
                        -->
                    </div>
                </div>
                <hr class=hr__ID>
                <div class=row>
                    <div class='col bk__ID'>
                        <b style='color:red'>This section only applies to new hires:</b>
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row">
                    <div class=col-md-3>
                        Work Details 
                    </div>
                    <div class=col-md-9>
                        <div class="row row__ID">
                            <div class=col-md-8>
                                The position requires a building access/swipe card 
                            </div>
                            <div class=col-md-4>
                                <label><input type="radio" name="Swipe_x0020_Card" value=1> Yes</label>&nbsp;&nbsp;&nbsp;
                                <label><input type="radio" name="Swipe_x0020_Card" value=0> No</label>
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-8>
                                The position requires a desk 
                            </div>
                            <div class=col-md-4>
                                <label><input type="radio" name="Desk" value=1> Yes</label>&nbsp;&nbsp;&nbsp;
                                <label><input type="radio" name="Desk" value=0> No</label>
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-8>
                                The position requires computer access 
                            </div>
                            <div class=col-md-4>
                                <label><input type="radio" name="Computer" value=1> Yes</label>&nbsp;&nbsp;&nbsp;
                                <label><input type="radio" name="Computer" value=0> No</label>
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-8>
                                The position requires Level 3 Lab access 
                            </div>
                            <div class=col-md-4>
                                <label><input type="radio" name="Lab_x0020_Access" value=1> Yes</label>&nbsp;&nbsp;&nbsp;
                                <label><input type="radio" name="Lab_x0020_Access" value=0> No</label>
                            </div>
                        </div>
                        <!--
                    -->
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row">
                    <div class=col-md-3>
                        Research Participant (If yes the employee needs vaccinations and Julia Chapman needs to be notified). 
                    </div>
                    <div class=col-md-9>
                        <div class="row row__ID">
                            <div class=col-md-8>
                                Will this position come into contact with patients/research participants? 
                            </div>
                            <div class=col-md-4>
                                <label><input type="radio" name="Patient_x0020_Contact" value=1> Yes</label>&nbsp;&nbsp;&nbsp;
                                <label><input type="radio" name="Patient_x0020_Contact" value=0> No</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row">
                    <div class=col-md-3>
                        Unikey 
                    </div>
                    <div class=col-md-9>
                        <div class="row row__ID">
                            <div class=col-md-8>
                                Have they ever been with Sydney University (Yes/No)? 
                            </div>
                            <div class=col-md-4>
                                <label><input type="radio" name="Assigned_x0020_Unikey" value=1> Yes</label>&nbsp;&nbsp;&nbsp;
                                <label><input type="radio" name="Assigned_x0020_Unikey" value=0> No</label>
                            </div>
                        </div>
                        <div class="row row__ID">
                            <div class=col-md-8>
                                If yes please advise their Unikey details: 
                            </div>
                            <div class=col-md-4>
                                <input type="text" class=form-control name=Unikey />
                            </div>
                        </div>
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Laundry Allowance Date
                    </div>
                    <div class=col-md-9>
                        <input type="date" class=form-control name=Laundry_x0020_Allowance_x0020_Da /> 
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        HR Admin
                    </div>
                    <div class=col-md-9>
                        <select class=form-control name=HR_x0020_Admin >
                            <option>Unassigned</option>
                            <option>Ann-marie Gregory</option>
                            <option>Brigette Sharp</option>
                            <option>Emily Persson</option>
                        </select>
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Status
                    </div>
                    <div class=col-md-9>
                        <select class=form-control name=Status >
                            <option>In Progress</option>
                            <option>On Hold</option>
                            <option>Declined</option>
                            <option>Approved</option>
                        </select>
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Notes
                    </div>
                    <div class=col-md-9>
                        <textarea class=form-control name=Notes ></textarea>
                    </div>
                </div>
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                            Sign off status
                    </div>
                    <div class=col-md-9>
                        <input type="text" class=form-control name=Sign_x002d_off_x0020_status /> 
                    </div>
                </div>
                
                <hr class=hr__ID>
                <div class="row row__ID">
                    <div class=col-md-3>
                        Attachments
                    </div>
                    <div class=col-md-9>
                        <div id=attachments__ID>

                        </div> 
                        <input type=file id=file__ID multiple />
                    </div>
                </div>
                
                <!---------------------------------------------------->
                <!-- submit button part for all tsak forms------------>
                <br>
                <hr class=hr__ID>
                <div class="row" id=completion__ID>
                    <div class=col>
                        <label><input type="checkbox" value=Completion name=FormStatus /> Completion</label>
                        <p>Important: Submit with the above completion checked will notify a HR staff to start process this request and you will not be allowed to modify this form again.</p>
                        <button id=asubmit__ID type="submit" class="btn btn-secondary">Submit</button>
                    </div>
                </div>
                <!---------------------------------------------------->
            </div>
        </form>
    </section>
    <script>
        function F__ID(){
    		//-------------------------------------
            VmInclude:__COMPONENT__/f/form.365.01.js
            //-------------------------------------
            var old_load=m.load;
            m.load=function(){
                var id=-1;
                if(m.input.record!=undefined) id=m.input.record["_id"];
                $('#completion__ID').hide();
                if(id!=-1){
                    if(m.input.record.Data.FormStatus!='Completion'){
                        m.input.record.Data.FormStatus="";
                        $('#completion__ID').show();
                    }
                }
                $('#completion__ID').show();
                old_load();
                m.endpoint_a=m.Table;
                m.endpoint_u=m.Table+"/"+id+"/fields";
                m.get_attachment(id);
            }
            //-------------------------------------
            m.total_file_num=0;
            m.before_submit=function(data,index){
                
                m.date_field(data,"Date_x0020_of_x0020_Birth");
                m.date_field(data,"Contract_x0020_Start_x0020_Date");
                m.date_field(data,"Contract_x0020_End_x0020_Date");
                m.date_field(data,"Laundry_x0020_Allowance_x0020_Da");
                
                m.string_array_field(data,"Primary_x0020_Department","Sleep_Technicians,Neurobiology,Sleep_and_Circadian,Sleep_Group,Cardio-metabolic,Epidemiology__Clinical_Trials,Operations,Commercial,Woolcock_Therapy_Centre,Woolcock_Reception,Clinical_Management,Respiratory_Technology,Airway_Physiology_and_Imaging,Emphysema_Group");
                m.string_array_field(data,"Usual_x0020_Days","Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday");
                m.string_array_field(data,"Award_x0020_Type","Award_Free,Health_Professionals_and_Support_Services_Award_2010,Professional_Employees_Award_2010,Clerks_Private_Sector_Award_2010,Hospitality_Industry_General_Award_2010,Manufacturing_and_Associated_Industries_and_Occupations_Award_2010");

                m.boolean_field(data,'Swipe_x0020_Card');
                m.boolean_field(data,'Desk');
                m.boolean_field(data,'Computer');
                m.boolean_field(data,'Lab_x0020_Access');
                m.boolean_field(data,'Patient_x0020_Contact');
                m.boolean_field(data,'Assigned_x0020_Unikey');
                
                return true;
            }
            //-------------------------------------
            m.arrayBufferToBase64=function(buffer) {
                var binary = '';
                var bytes = new Uint8Array(buffer);
                var len = bytes.byteLength;
                for (var i = 0; i < len; i++) {
                    binary += String.fromCharCode(bytes[i]);
                }
                return btoa(binary);
            }
            //-------------------------------------
            m.get_attachment=function(id){
                //alert(id);
                $vm.m365_msal.acquireTokenSilent($vm.m365_scope_sharepoint).then(function (tokenResponse) {
                    var endpoint=m.v1_endpoint+"/items("+id+")/AttachmentFiles"
                    var xmlHttp = new XMLHttpRequest();
                    xmlHttp.onreadystatechange = function () {
                        if (this.readyState == 4 && this.status == 200){
                            var data=JSON.parse(this.responseText);  
                            m.get_attachment_render(data)
                        }
                    }
                    xmlHttp.open("GET", endpoint, true); // true for asynchronous
                    xmlHttp.setRequestHeader('Authorization', 'Bearer ' + tokenResponse.accessToken);
                    xmlHttp.setRequestHeader("Accept", "application/json");  
                    xmlHttp.setRequestHeader("Content-Type", "application/json; charset=utf-8");  
                    xmlHttp.setRequestHeader("OData-MaxVersion", "4.0");  
                    xmlHttp.setRequestHeader("OData-Version", "4.0");  
                    xmlHttp.send();
                })
            }
            //-------------------------------------
            m.get_attachment_render=function(data){
                console.log(data);
                var txt="";
                for(var i in data.value){
                    var a=data.value[i];
                    var name=a.FileName;
                    var url=$vm.m365_sharepoint_uri+"/"+a.ServerRelativePath.DecodedUrl+"?web=1";
                    txt+="<a target=_blank href='"+url+"'>"+name+"</a><br>"
                }
                $('#attachments__ID').html(txt);
            }
            //-------------------------------------
            m.upload_a_file=function(file,id){
                var reader = new FileReader();
                reader.onload=function (e) {
                    var buffer=e.target.result;
                    //var str=m.arrayBufferToBase64(buffer);
                    //console.log(str);
                    $vm.m365_msal.acquireTokenSilent($vm.m365_scope_sharepoint).then(function (tokenResponse) {
                        var endpoint=m.v1_endpoint+"/items("+id+")/AttachmentFiles/add(FileName='" + file.name + "')";
                        var xmlHttp = new XMLHttpRequest();
                        xmlHttp.onreadystatechange = function () {
                            if (this.readyState == 4 && this.status == 200){
                                var data=JSON.parse(this.responseText);  
                                console.log(data);
                                alert("OK");
                                m.upload_a_file_end();
                            }
                            else if (this.readyState == 4 && (this.status == 400 || this.status == 500)) {
                                var res=JSON.parse(this.responseText); 
                                $vm.alert(res.error.message);
                            }
                        }
                        xmlHttp.open("POST", endpoint, true); // true for asynchronous
                        xmlHttp.setRequestHeader('Authorization', 'Bearer ' + tokenResponse.accessToken);
                        xmlHttp.setRequestHeader("Accept", "application/json");  
                        //xmlHttp.setRequestHeader("content-length", buffer.byteLength);  
                        //xmlHttp.setRequestHeader("Content-Type", "application/json");  
                        xmlHttp.setRequestHeader("OData-MaxVersion", "4.0");  
                        xmlHttp.setRequestHeader("OData-Version", "4.0");  
                        xmlHttp.send(buffer);
                    })
                }
                reader.readAsArrayBuffer(file);
            }
            //-------------------------------------
            m.upload_a_file_end=function(){
                m.total_file_num--;
                if(m.total_file_num==0){
                    alert("End");
                    $vm.refresh=1;
                    var rid=undefined; if(m.input.record!=undefined) rid=m.input.record._id;
                    if(m.input.goback!=undefined) window.history.go(-1);            //from grid
                    else if(rid!=undefined) window.history.go(-1);                  //modify
                    else $vm.alert('Your data has been successfully submitted');    //standalone
                }
            }
            //-------------------------------------
            m.put_attachment_process=function(data,res){
                var id=res.id;
                var files = document.getElementById("file__ID").files;
                m.total_file_num=files.length;
                if(m.total_file_num!=0){
                    for(var i=0;i<files.length;i++){
                        var file=files[i];
                        m.upload_a_file(file,id);
                    }
                }
                else{
                    $vm.refresh=1;
                    var rid=undefined; if(m.input.record!=undefined) rid=m.input.record._id;
                    if(m.input.goback!=undefined) window.history.go(-1);            //from grid
                    else if(rid!=undefined) window.history.go(-1);                  //modify
                    else $vm.alert('Your data has been successfully submitted');    //standalone
                }
            }
            //-------------------------------------
            m.after_insert=function(data,res){m.put_attachment_process(data,res);}
            m.after_update=function(data,res){m.put_attachment_process(data,res);}
            //-------------------------------------
        }
    </script>
    <style>
        #form_container__ID{
            max-width:1200px;
        }
        VmInclude:__COMPONENT__/f/form.01.css
        .hr__ID{
            margin:6px 0;
            padding:0;
        }
        .bk__ID{
            background-color: #eee;
            padding:5px 6px;
            margin:0 15px;
        }
    </style>
</div>